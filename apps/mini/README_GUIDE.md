# BabyTracker Pro 小程序文档 (v1.3.0)

## 1. 产品简介
BabyTracker Pro 是一款专为新手父母设计的宝宝成长记录工具。通过现代化的 UI 设计和高效的数据管理，帮助父母详尽记录宝宝的喂奶、睡眠及日常动态。

## 2. 核心功能点
### 2.1 首页 (Dashboard)
- **宝宝动态概览**：顶部显示宝宝昵称及当前月龄/天数。
- **今日统计卡片**：
  - **今日奶量**：自动汇总当日累计喂奶毫升数。
  - **今日睡眠**：自动汇总当日累计睡眠时长，支持跨天睡眠计算。
- **可视化进度条**：直观展示当日喂奶和睡眠目标完成情况。
- **全宽度日期导航**：支持点击箭头或使用日期选择器切换查看历史记录。
- **时间轴记录**：将记录按「早晨」、「下午」、「晚上」进行归类展示，清晰呈现全天作息。

### 2.2 记录功能 (Recording)
- **多类型记录**：支持喂奶、睡眠及其他日常（如换纸尿裤、运动等）。
- **快捷时间选择**：
  - 支持「昨天/今天」切换，方便补录跨深夜的记录。
  - 精确到分钟的开始与结束时间设置。
- **内容编辑与删除**：在首页点击任意记录卡片，通过底部菜单进行「编辑」或「删除」操作。

### 2.3 导航系统 (Navigation)
- **高端定制底栏**：采用毛玻璃（Glassmorphism）特效和全透明 SVG 图标，确保在各种背景下均有高标准的视觉呈现。
- **路由逻辑**：智能追踪当前页面，确保 Tab 状态与实际页面完美同步。

## 3. 操作说明
### 3.1 记录一条喂奶
1. 点击底栏中间的「记录」图标。
2. 确保类型选中「喂奶」。
3. 输入毫升数（如 120ml）。
4. (可选) 填写备注。
5. 点击「添加记录」。

### 3.2 记录一段跨深夜的睡眠 (如昨晚 21:00 到今早 07:00)
1. 进入记录页，选中「睡眠」类型。
2. 在开始时间上方勾选「昨天」。
3. 设置开始时间为 21:00。
4. 结束时间设为「今天」的 07:00。
5. 提交后，此记录将自动出现在「今天」早晨的时间轴顶部。

### 3.3 修改或删除记录
1. 在首页找到对应的记录。
2. 长按或直接点击该记录条目。
3. 在弹出的菜单中选择「编辑记录」或「删除」。

### 3.4 用于测试的账号信息
为方便快速体验 App 功能，您可以使用以下测试账号直接登录：
- **账号**：`zhang_rf0@163.com`
- **密码**：`test123`

### 3.5 邮箱注册
1. 在登录页面点击底部的「使用账号登录/注册」按钮。
2. 点击输入框下方的「没有账号？去注册」切换到注册模式。
3. 输入您的邮箱和密码，点击「注册」。
4. 注册成功后可直接登录使用。

## 4. 架构说明
### 4.1 技术栈
- **前端框架**：[Taro 4](https://docs.taro.zone/) (React + TypeScript)。
- **样式处理**：Vanilla SCSS + CSS Variables，支持现代灵动设计。
- **后端平台**：[Supabase](https://supabase.com/) (PostgreSQL + GoTrue Auth)。
- **通信层**：原生的 `wx.request` 封装，针对小程序环境优化，避免了笨重的第三方 SDK。

### 4.2 核心架构逻辑
- **数据流管理**：基于 React Context (`AuthContext`) 的全局状态管理，负责用户信息、宝宝配置及全局 Loading 状态。
- **数据一致性**：
  - 采用 ISO 8601 标准存储时间。
  - 针对小程序网络环境，在 `lib/supabase.ts` 中实现了严谨的 URI 编码处理，确保特殊字符的数据请求安全。
- **持久化设计**：Session 自动加密存储在微信本地 Storage，实现冷启动免登录。
- **认证体系**：
  - **当前**：支持邮箱/密码登录、游客模式。
  - **规划中 (v1.2.0)**：微信一键授权登录，支持通过映射表实现「一人账号，全家共享」的权限模型。

## 5. 最近更新 (v1.3.0)
- **新功能**：新增邮箱注册功能，支持用户直接在小程序内注册账号。
- **稳定性**：
  - 重写了底部导航栏 (Custom Tab Bar) 为 Class Component，彻底解决了高亮不准确、图标加载失败及切换时序问题。
  - 优化了 Auth 模块，修复了已知的问题。
- **UI 优化**：修复了导航栏图标切边和字体过小、统计文本换行的问题。
- **稳定性**：重构了跨天数据检索算法，解决了深夜记录「失踪」的 Bug。
- **性能**：优化了 Supabase 客户端请求逻辑，显著提升页面加载速度。
